language: java
sudo: false
dist: trusty
jdk:
- oraclejdk8
- oraclejdk9
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.m2"
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
before_install:
- openssl aes-256-cbc -K $encrypted_2c5a45ddad64_key -iv $encrypted_2c5a45ddad64_iv
  -in deploy/secring.gpg.enc -out deploy/secring.gpg -d
- openssl aes-256-cbc -K $encrypted_2c5a45ddad64_key -iv $encrypted_2c5a45ddad64_iv
  -in deploy/pubring.gpg.enc -out deploy/pubring.gpg -d
- mvn install:install-file -Dfile=lib/spring-restdocs-core-2.0.2.RELEASE-test.jar
  -DgroupId=org.springframework.restdocs -DartifactId=spring-restdocs-core -Dversion=2.0.2.RELEASE
  -Dpackaging=jar -Dclassifier=test
script:
- mvn install -B -V
- cd samples
- mvn install -B -V
- test "$TRAVIS_JDK_VERSION" = "oraclejdk8" && cd java-webmvc && ./gradlew check &&
  cd .. || (exit 0)
- test "$TRAVIS_JDK_VERSION" = "oraclejdk8" && cd kotlin-webmvc && ./gradlew check
  && cd .. || (exit 0)
after_success:
- cd $TRAVIS_BUILD_DIR
- test "$TRAVIS_BRANCH" = "master" && test "$TRAVIS_PULL_REQUEST" = "false" && test
  "$TRAVIS_JDK_VERSION" = "oraclejdk8" && mvn deploy --settings
  "$DEPLOY_DIR/travis-settings.xml" -DskipTests=true -B -V
- test "$TRAVIS_BRANCH" = "sign-test" && test "$TRAVIS_PULL_REQUEST" = "true" &&
  test "$TRAVIS_JDK_VERSION" = "oraclejdk9" && cd spring-auto-restdocs-json-doclet-jdk9
  && mvn deploy --settings "$DEPLOY_DIR/travis-settings.xml" -DskipTests=true -B -V
branches:
  only:
  - master
env:
  global:
  - DEPLOY_DIR="$TRAVIS_BUILD_DIR/deploy"
  - secure: HfdOqviZAi8PbT1uVMTRx1zt59SxuN23po4j9fDCNT9/xV+0rGKPE8fHEDQ91u4dp7CtAdl20LoRhhyVycg2r87RmjxURuT4fYL1mMpnWJCNaeABvdZUme/73waUQiJ7Y4RW80t+GFMmiPX94Jj52gH24xTV5WbHOn+QyobRKrVeFQcxWPIzVYji3ZKAVeSOXlqp9CE/DbopHEYhIM7/YM7ut91A+JwKuo2k2hhl7fzTfXi+0y7Q7kY3Jzjzt2spE5h4g3o9n8GiK9TlaCXGT8+KiSFa+01IFs5GLMP/ZCdcsmNyux2Yeo86MG0pT/sfnOHuvP1LN6spIfob7if7SRRB6me9jDwD3JIUajX5RcswtP6ItoZu88l8rXRO+WPl/Fz5QvmmixWqWXeCCUY0KZ/jlNvIbu9cBLB7mkM0bOe7I1KfKm2tv6R22c5hfK8erN+1mnb6A6Ul3IBMoTYs3PJEoxklutM5cHBA193euLpk+YatQPd9nZHvoXtScW5klHvICP51vw7Q3Acy5ONDC20vKet3TeGUDQ8S/2Pj8QqxSncFt4KLTEa3TBz1UKkRibl4yeaq00GcChiunL1JF4tx0t5poX6vcFZEln5CosTkVg9e/pcJwnZ+BFCsrMvAiVMX1lgPeqPcYzHd4w+tZxES6hycEAdtgPUbBK9eGkI=
  - secure: gJbbzNHBLy6OeH2d2YVh7n6zfDQbnyYpb3A6ccreWyxDQvg7H8SmGGSXU6lpy0VvT2ZhYS3B5XWLrQqSuCYwWTfs1sudyRb6yfxp76RZ3Hd7QTCxdrCbLak0qEI1KdlSFDhNvO7kL6FxvW9/oDSvpT3IX9PGDtVapwUAdp6MNMKO5LMuPn/vNrCt2a3XDFqk84C7r2Vx9gI++4FLCT4LVPWcxQM8wgy2Y8FGZfe8BflVCld9aOBeCh/XfUolbGNyHRZE6daMuTKr8zrOTLEA1pDZIcWPJ3MHS2r/8B2h9coj2Fah6vgR9itTA+2pkXfDAJedjlcapkVMPWNcbodcyEWW3qqbXBsEx12pKKGYs0uk6pY6y0BIm/hid9L3zvTjUdy1VJPFlOlWbKF04pD7jhxl5Dkvub9ziCtR8qLmu1SxwgNL0P7b0qKZuVakuoBDSTBd6x23Lvw+Hzolu2I7CnMpov6fZoNzB+PpP1yjqSIuVfP1Um/dDlqchU0qXg2bPE6dRUC4vtxs63SGffjnTsMP7G9yL8IeMcUmtwyyY0CqfZ1xkG6wUWF1uoRs0EdWPQGUOBTAerLUEqFhQqwnOfBj/CJIyvs+2Rg+Schwoc5ZKA9qlQccMLkf/j7vCGZ5Pl2d5/ln7kC+XMJ4RjBhwQGM2P0U1aYRkXFlCOZPjA4=
  - secure: f/235uW+cBE7ivxGiZr6gQnaYTjjI+GxJMNyo6PdLaL8dLQcBfOeTJqQD2hzfnKnVCBVR+/F+xpkudMu8S+L0kHMObWM6TjoRxYE/woGNx8OsOEx2UiosHe/c7SIoEiY2zJIRCdQo+FvTrbQqcznTzGA6Cf0BikARoS5YImScWMfPc2fsx5kb0H+ePkFPeksizwF6EZlnx89gZFoQv9kpFzNSBf+3wsHv18QtUOIbfvT5y6vnHLiTSif7VzcQzJPI+TsTgN0g6wJGTfjUDtgUh/nzq8SQymTx/gQ6UhYkz8esjNf97nlH3megLwWhJSLQ+NiSR9u82RaU6gPmG0t6mWPvO/weN0yWwbrc5PFVLNcZOSUz/kmKBHojGPNMnISbAGPRptK1XsxSquEPGNFDCq3XXokErFlwcYy5PBB2XT5pm0UZ0+ttWcwDFlwU9iW8PbVaaEqON67o2vkDiV8pygm2Lm19h9mr3zI5tmk1AS/Bb8gg4X4IL+Yf3hm6/6PpAUSY5IP2Sq5M0q188ZGiZu0KrEXjG3RK2u4QqMcSAQsPxI/+PvIEBZiwe8xGr8UDroanGnNmMeCaUPQVd9lhs9X6hxAK/ObDgVw1jQ5GZilJmqk2PfC02ZVQm0Bkgb117J403B+FWxR9H138MWTdIauTpPStNVhHoRu0ZovbJk=
  - secure: VdgmebbepITWlIQf6sucy7+oKSdBWvpbLZe7OFo/dfSekiX2ZoUTGxUTdRypZKbHXzQSGUtk3v9FSwbpEtJUTFAwfq4Majb//4+DJSJKpXNTYUYJACoLDz3F5YQYSLPIiVO4rdnDY/4wJa/bl9UZs4ADzhN0FLYOqzt6v5YQ2nrtwGyDoy+ryLAQuz/jNaZJBeV8GYtrEELOoiX98p622j6BzvNnFg9pxrPZftcjXOuN10jvv4gcY555+GXVZ5bVbnqj1rTUuPKlnxk4wqvXpZoJvtVLJJshwKg4Wolic062NL0X1kGNS9sbPOkirsJrCgESAf1pC3r7ftMywblzdFOmzv0khVBylAnQKMM2oce8uaZt81tTHWyDufyzuaaiVhCyRdW3s/Pxu2dLxsDOq9h1DvG7otIhG7pqzLF7uX/rCuOBU5AKQmFKi/Q+cUfGIEznzoFB27OCAOu58iFCT25LJoMqmZwDn2E4HTIECO2qu8qnILy+gNGmlD3yF1tMvf5S5chYfenra8dZDmCmA0bW2iZr59R+IyZzCKeeylolQFVJbnQI6AcsmTRJ/ed7IVFFzAKqm2HbCnV39/DMmih5Pn9wI8g7K4elq3TgqGFmkH+eh+KpQauo0DpMtfqvO1NlVeTKaD/2sEQRt1jhtRNVcRTV3ihX2RYaz0ly6QE=
