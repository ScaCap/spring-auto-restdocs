:core-dir: https://github.com/ScaCap/spring-auto-restdocs/blob/master/spring-auto-restdocs-core
:core-package: {core-dir}/src/main/java/capital/scalable/restdocs

[[snippets]]
== Snippets

[[snippets-method-path]]
=== Method and path snippet

link:{core-package}/misc/MethodAndPathSnippet.java[Method and path snippet] takes a `value` (path) and `method` from `RequestMapping` annotation on the Controller's method.
The shorthand annotations `GetMapping`, `PostMapping`, etc. are supported as well.

.Code
[source,java]
----
@GetMapping(value = "/items")
public ItemResponse getItems() { ... }
----

.Result
----
GET /items
----

[[snippets-description]]
=== Description snippet

link:{core-package}/misc/DescriptionSnippet.java[Description snippet] outputs the Controller's method's Javadoc.
Currently only basic `br`, `p`, `ul` and `li` tags are supported.

.Code
[source,java]
----
/**
 * Returns list of all items.
 * <p>
 * Use query parameters to filter the list by:
 * <ul>
 *   <li>orderNumber</li>
 *   <li>type</li>
 * </ul>
 */
@GetMapping...
public ItemResponse getItems() { ... }
----

.Result
----
Returns list of all items.

Use query parameters to filter the list by:
- orderNumber
- type
----

[[snippets-authorization]]
=== Authorization snippet

link:{core-package}/misc/AuthorizationSnippet.java[Authorization snippet] does not help in adding authorization to your tests, but it makes it easy to document your authorization information.
Usually, a custom `RequestPostProcessor` is used to add authorization and this is also the place where you add the documentation.

.Code
[source,java]
----
protected RequestPostProcessor userToken() {
    return new RequestPostProcessor() {
        @Override
        public MockHttpServletRequest postProcessRequest(MockHttpServletRequest request) {
            // <Code to get access token>
            request.addHeader("Authorization", "Bearer " + accessToken);
            return documentAuthorization(request, "User access token required.");
        }
    };
}

@Test
public void addItem() throws Exception {
    mockMvc.perform(post("/items").with(userToken())
    ...
}
----

.Result
----
User access token required.
----

[[snippets-path-parameters]]
=== Path parameters snippet

link:{core-package}/request/PathParametersSnippet.java[Path parameters snippet] automatically lists parameters in the path including their type, whether they are optional, and their Javadoc with constraints.

.Code
[source,java]
----
/**
 * @param id ID of the item.
 */
@GetMapping("{id}")
public ItemResponse getItem(@PathVariable String id) { ... }
----

.Result
|===
|Parameter|Type|Optional|Description

| id
| String
| false
| ID of the item.

|===

==== Configuration

Configuration available during MockMvc setup:

- `failOnUndocumentedParams` - if build should fail on at least one undocumented parameter

[[snippets-request-parameters]]
=== Request parameters snippet

link:{core-package}/request/RequestParametersSnippet.java[Request parameters snippet] automatically lists query parameters including their type, whether they are optional, and their Javadoc with constraints. If a default value is set, it will also be included.

.Code
[source,java]
----
/**
 * @param descMatch Lookup on description field.
 * @param lang Lookup on language.
 */
@GetMapping("search")
public Page<ItemResponse> searchItem(
 @RequestParam("desc") String descMatch,
 @RequestParam(value= "language", required = false, defaultValue = "en") String lang
 ) { ... }
----

.Result
|===
|Parameter|Type|Optional|Description

| desc
| String
| false
| Lookup on description field.

| language
| String
| true
| Lookup on language.

Default value: "en".

|===

==== Configuration

Configuration available during MockMvc setup:

- `failOnUndocumentedParams` - if build should fail on at least one undocumented parameter

[[snippets-modelattribute]]
=== Model Attribute snippet

link:{core-package}/payload/JacksonModelAttributeSnippet.java[Model Attribute snippet] automatically recognises POJOs annotated with `@ModelAttribute` annotation. Depending on HTTP method, it generates either section for <<snippets-request-parameters,request parameters>> (`GET`) or <<snippets-request-fields,request fields>> (non `GET`). This snippet works also for model attributes without annotation, as specified in https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-arguments["any other argument"] section of Spring MVC reference documentation.

.Code
[source,java]
----
@GetMapping("search")
public SearchResult search(@ModelAttribute SearchCriteria criteria){ ... }

class SearchCriteria {
    /** Lookup on description field. */
    @NotBlank
    String descMatch;
    /** Lookup on language. */
    String lang;
}
----

==== Configuration

Configuration available during MockMvc setup:

- `failOnUndocumentedFields` - if build should fail on at least one undocumented field

[[snippets-request-headers]]
=== Request headers snippet

link:{core-package}/request/RequestHeaderSnippet.java[Request headers snippet] automatically lists headers with their type, whether they are optional, and their Javadoc with constraints. If a default value is set, it will also be included.

.Code
[source,java]
----
/**
 * @param lang Language we want the response in.
 */
@GetMapping("/all")
public ItemResponse getItem(
@RequestHeader(value = "Accept-Language", required = false, defaultValue = "en") String lang
) { ... }
----

.Result
|===
|Parameter|Type|Optional|Description

| Accept-Language
| String
| true
| Language we want the response in.

Default value: "en".

|===

[[snippets-request-fields]]
=== Request fields snippet

link:{core-package}/payload/JacksonRequestFieldSnippet.java[Request fields snippet] automatically lists all fields of the request class, determined from `@RequestBody` parameter of Controller's method.
List includes name, type, whether the field is optional, and its Javadoc with constraints.

.Code
[source,java]
----
@PostMapping
public void addItem(@RequestBody ItemUpdateRequest request) { ... }

static class ItemUpdateRequest {
    /**
     * Item ID.
     */
    @NotBlank
    private Integer id;

    /**
     * Item description.
     */
    @Size(max = 20)
    private String description;
}
----

.Result
|===
|Path|Type|Optional|Description

| id
| Integer
| false
| Item ID.

| description
| String
| true
| Item description.

Size must be between 0 and 20 inclusive.

|===

==== Configuration

Configuration available during MockMvc setup:

- `failOnUndocumentedFields` - if build should fail on at least one undocumented field
- `requestBodyAsType` - specified class should be considered as request type instead of endpoint method's parameter

[[snippets-response-fields]]
=== Response fields snippet

link:{core-package}/payload/JacksonResponseFieldSnippet.java[Response fields snippet] automatically lists all fields of the response class, determined from return value of Controller's method.
List includes name, type, whether the field is optional, and its Javadoc with constraints.

.Code
[source,java]
----
@GetMapping("{id}")
public ItemResponse getItem(@PathVariable String id) { ... }

static class ItemResponse {
    /**
     * Unique item ID.
     */
    @NotBlank
    private String id;

    /**
     * Item's order number.
     */
    @Min(1)
    private Integer orderNumber;
}
----

.Result
|===
|Path|Type|Optional|Description

| id
| Integer
| false
| Unique item ID.

| orderNumber
| Integer
| true
| Item's order number.

Must be at least 1.

|===

==== Configuration

Configuration available during MockMvc setup:

- `failOnUndocumentedFields` - if build should fail on at least one undocumented field
- `responseBodyAsType` - specified class should be considered as response type instead of endpoint method's return type

include::section-snippet.adoc[]

[[snippets-links]]
=== Links snippet

link:{core-package}/hypermedia/LinksSnippet.java[Links snippet] lists all possible links inside the response.
In most cases, links cannot be determined from the response class,
because they are highly dynamic depending on a resource state and often just stored in a Map.
Therefore this snippet needs a custom class describing possible links, with field names acting as link _rel_s and
field's Javadoc and annotions used as usually to determine the comment, optionality, deprecation, etc.
List includes name, whether the link is optional, and its Javadoc description.

.Code
[source,java]
----
@GetMapping
public ItemResponse getItem() {
    ItemResponse response = new ItemResponse();
    response.add(linkTo(methodOn(ItemResource.class).getItem()).withSelfRel());
    return response;
}

static class ItemResponse extends org.springframework.hateoas.ResourceSupport {
  ...
}
----

The corresponding test method needs to be configured with documentation type:

.MockMvc test method
[source,java]
----
@Test
public void getItem() throws Exception {
    mockMvc.perform(get(...))
    ...
        .andDo(links().documentationType(LinksDocumentation.class));
}

static class LinksDocumentation {
    /**
     * Link to this item.
     */
    @NotNull
    private String self;

    /**
     * Link to item's metadata.
     */
    private String metadata;
}
----

.Result
|===
|Path|Optional|Description

| self
| false
| Link to this item.

| metadata
| true
| Link to item's metadata.

|===

==== Configuration

Configuration available during MockMvc setup:

- `failOnUndocumentedFields` - if build should fail on at least one undocumented field
- `documentationType` - specified class should be considered for documentation

[[snippets-embedded]]
=== Embedded snippet

link:{core-package}/hypermedia/EmbeddedSnippet.java[Embedded snippet] lists all embedded resources of the response.
Similarly to LinksSnippet, documentation is determined from custom documentation class.
List includes name, type, whether the field is optional, and its Javadoc with constraints.

.Code
[source,java]
----
@GetMapping
public ItemResponse getItem() {
    ItemResponse response = new ItemResponse();
    response.embed(getAttributes());
    response.embed(getMetadata());
    return response;
}

static class ItemResponse extends EmbeddedSupport {
  ...
}
----

The corresponding test method needs to be configured with documentation type:

.MockMvc test method
[source,java]
----
@Test
public void getItem() throws Exception {
    mockMvc.perform(get(...))
    ...
        .andDo(embedded().documentationType(EmbeddedDocumentation.class));
}

static class EmbeddedDocumentation {
    /**
     * Item's attributes.
     */
    @NotNull
    private Attributes attributes;

    /**
     * Item's metadata.
     */
    private List<Metadata> metadata;
}
----

.Result
|===
|Path|Type|Optional|Description

| attributes
| Object
| false
| Item's attributes.

| metadata
| Array[Object]
| true
| Item's metadata

|===

==== Configuration

Configuration available during MockMvc setup:

- `failOnUndocumentedFields` - if build should fail on at least one undocumented field
- `documentationType` - specified class should be considered for documentation

include::section-snippet.adoc[]

[[snippets-custom]]
=== Custom snippet

Custom snippets are created by subclassing the link:{restdocs-package}/snippet/Snippet.java[Snippet] interface
(or more conveniently link:{restdocs-package}/snippet/TemplatedSnippet.java[TemplatedSnippet]).
Template for the snippet must be put into `org/springframework/restdocs/templates/asciidoctor`
(optionally also `org/springframework/restdocs/templates/markdown`) resource package. The template name
must correspond with the snippet name passed to the class constructor.
You can also <<snippets-section-custom-snippet,include your custom snippet in a section>>.

[[snippets-customization]]
=== Snippet customization

Provide your own template in `org/springframework/restdocs/templates/asciidoctor` (or `markdown`) package of your resources.
You can override link:https://github.com/spring-projects/spring-restdocs/tree/v${spring-restdocs.version}/spring-restdocs-core/src/main/resources/org/springframework/restdocs/templates[REST Docs templates]
and link:https://github.com/ScaCap/spring-auto-restdocs/tree/master/spring-auto-restdocs-core/src/main/resources/org/springframework/restdocs/templates[Auto REST Docs templates].
Important is to omit `default-` part from the template name so that the resolution algorithm will prefer this custom template.
See also link:http://docs.spring.io/spring-restdocs/docs/${spring-restdocs.version}/reference/html5/#documenting-your-api-customizing-snippets[original documentation] for additional details.